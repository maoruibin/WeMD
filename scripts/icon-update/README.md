# Icon æ›´æ–°ä»»åŠ¡é˜Ÿåˆ—è®¾è®¡æ–‡æ¡£

> **ç›®æ ‡**: è‡ªåŠ¨åŒ– icon èµ„æºæ›´æ¢æµç¨‹ï¼Œä»è®¾è®¡å¯¼å‡ºåˆ°ä¸Šä¼ æ›´æ–°ä¸€é”®å®Œæˆ

---

## ğŸ“Š æµç¨‹å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Icon æ›´æ–°ä»»åŠ¡é˜Ÿåˆ—                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ 1. å¯¼å‡º  â”‚ -> â”‚ 2. è½¬æ¢ â”‚ -> â”‚ 3. ä¸Šä¼  â”‚ -> â”‚ 4. æ›´æ–° â”‚    â”‚
â”‚  â”‚   SVG   â”‚    â”‚   å¤šå°ºå¯¸ â”‚    â”‚   å›¾åºŠ  â”‚    â”‚   å¼•ç”¨  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                   ä»»åŠ¡é˜Ÿåˆ—é…ç½®                          â”‚   â”‚
â”‚  â”‚  - å¹¶å‘æ§åˆ¶: åŒæ—¶ä¸Šä¼ æ•°é‡                                â”‚   â”‚
â”‚  â”‚  - é‡è¯•ç­–ç•¥: å¤±è´¥è‡ªåŠ¨é‡è¯•                                â”‚   â”‚
â”‚  â”‚  - è¿›åº¦æŠ¥å‘Š: å®æ—¶æ˜¾ç¤ºè¿›åº¦                                â”‚   â”‚
â”‚  â”‚  - å›æ»šæœºåˆ¶: å¤±è´¥æ—¶å›æ»šå·²æ›´æ”¹çš„æ–‡ä»¶                      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ ç›®å½•ç»“æ„

```
scripts/
â”œâ”€â”€ icon-update/
â”‚   â”œâ”€â”€ index.ts              # ä¸»å…¥å£
â”‚   â”œâ”€â”€ queue.ts              # ä»»åŠ¡é˜Ÿåˆ—å®ç°
â”‚   â”œâ”€â”€ tasks.ts              # ä»»åŠ¡å®šä¹‰
â”‚   â”œâ”€â”€ exporter.ts           # SVG/PNG å¯¼å‡º
â”‚   â”œâ”€â”€ uploader.ts           # å›¾åºŠä¸Šä¼ 
â”‚   â”œâ”€â”€ updater.ts            # æ›´æ–°å¼•ç”¨
â”‚   â”œâ”€â”€ config.ts             # é…ç½®
â”‚   â””â”€â”€ types.ts              # ç±»å‹å®šä¹‰
â””â”€â”€ update-icons.mts          # CLI å…¥å£
```

---

## ğŸ”§ ä»»åŠ¡å®šä¹‰

### Task1: ExportSVGTask
- **è¾“å…¥**: logo-preview-v2.html ä¸­çš„ SVG ä»£ç 
- **è¾“å‡º**: `apps/web/public/favicon-{dark,light}.svg`
- **å¤„ç†**:
  - æå–ä¸»è®¾è®¡ SVG
  - ç”Ÿæˆæ·±è‰²/æµ…è‰²å˜ä½“

### Task2: ConvertPNGTask
- **è¾“å…¥**: å¯¼å‡ºçš„ SVG æ–‡ä»¶
- **è¾“å‡º**: å¤šå°ºå¯¸ PNG æ–‡ä»¶
- **å°ºå¯¸**: 16x16, 32x32, 64x64, 128x128, 256x256, 512x512
- **ç›®æ ‡**:
  - `apps/web/public/favicon-dark.png`
  - `apps/electron/assets/icon.png`

### Task3: ConvertICOTask
- **è¾“å…¥**: 256x256 PNG
- **è¾“å‡º**: `apps/electron/assets/icon.ico`
- **å°ºå¯¸**: 16, 32, 48, 256

### Task4: UploadImageTask
- **è¾“å…¥**: æœ¬åœ°å›¾ç‰‡æ–‡ä»¶
- **è¾“å‡º**: å›¾åºŠ URL
- **é…ç½®**: ä»ç¯å¢ƒå˜é‡è¯»å–å›¾åºŠé…ç½®

### Task5: UpdateReferencesTask
- **è¾“å…¥**: æ–°æ—§ URL æ˜ å°„
- **è¾“å‡º**: æ›´æ–°åçš„æ–‡ä»¶
- **ç›®æ ‡æ–‡ä»¶**:
  - `README.md`
  - `apps/web/src/store/editorStore.ts`
  - `apps/docs/src/.vuepress/config.ts`
  - `apps/web/index.html`

---

## ğŸ” é…ç½®æ–‡ä»¶

### `scripts/icon-update/config.ts`
```typescript
export const ICON_UPDATE_CONFIG = {
  // SVG æºæ–‡ä»¶
  sourceHtml: 'logo-preview-v2.html',

  // è¾“å‡ºç›®å½•
  outputDirs: {
    web: 'apps/web/public',
    electron: 'apps/electron/assets',
    exports: 'assets/icons',  // å¯¼å‡ºçš„ä¸´æ—¶ç›®å½•
  },

  // å›¾åºŠä¸Šä¼ é…ç½®
  upload: {
    enabled: true,
    provider: 'official',  // æˆ– 'qiniu', 'aliyun', 's3'
    cdnUrl: 'https://img.wemd.app',
  },

  // éœ€è¦æ›´æ–°çš„æ–‡ä»¶
  updateFiles: [
    'README.md',
    'apps/web/src/store/editorStore.ts',
    'apps/docs/src/.vuepress/config.ts',
  ],

  // URL æ˜ å°„
  urlMappings: {
    'https://img.wemd.app/favicon-dark.png': 'favicon-dark.png',
    'https://weimd.gudong.site/favicon-light.svg': 'favicon-light.svg',
  },
};
```

---

## ğŸ“ ä»»åŠ¡é˜Ÿåˆ—æ¥å£

```typescript
interface Task {
  id: string;
  name: string;
  execute(): Promise<TaskResult>;
  rollback?(): Promise<void>;
}

interface TaskResult {
  success: boolean;
  data?: unknown;
  error?: Error;
}

interface TaskQueue {
  add(task: Task): void;
  run(): Promise<TaskResult[]>;
  pause(): void;
  resume(): void;
  cancel(): void;
}
```

---

## ğŸš€ CLI ä½¿ç”¨

```bash
# æ‰§è¡Œå®Œæ•´æ›´æ–°æµç¨‹
pnpm update-icons

# ä»…å¯¼å‡ºï¼Œä¸ä¸Šä¼ 
pnpm update-icons --export-only

# æŒ‡å®šå›¾åºŠä¸Šä¼ 
pnpm update-icons --upload qiniu

# é¢„è§ˆå˜æ›´ï¼ˆä¸å®é™…ä¿®æ”¹ï¼‰
pnpm update-icons --dry-run
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **å¤‡ä»½**: æ‰§è¡Œå‰è‡ªåŠ¨å¤‡ä»½æ‰€æœ‰å°†è¦ä¿®æ”¹çš„æ–‡ä»¶
2. **éªŒè¯**: ä¸Šä¼ åéªŒè¯å›¾ç‰‡å¯è®¿é—®
3. **å›æ»š**: å¤±è´¥æ—¶è‡ªåŠ¨å›æ»šåˆ°å¤‡ä»½çŠ¶æ€
4. **æ—¥å¿—**: è®°å½•æ‰€æœ‰æ“ä½œåˆ°æ—¥å¿—æ–‡ä»¶
